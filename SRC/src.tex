\documentclass[acmsmall,nonacm=true,screen=true]{acmart}
\settopmatter{printfolios=true,printccs=false,printacmref=false}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Bibliography style
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{ACM-Reference-Format}
%\citestyle{acmauthoryear}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% URLs
\newcommand\site[1]{\footnote{\url{#1}}}

%% ODER: format ==         = "\mathrel{==}"
%% ODER: format /=         = "\neq "
%
%
\makeatletter
\@ifundefined{lhs2tex.lhs2tex.sty.read}%
  {\@namedef{lhs2tex.lhs2tex.sty.read}{}%
   \newcommand\SkipToFmtEnd{}%
   \newcommand\EndFmtInput{}%
   \long\def\SkipToFmtEnd#1\EndFmtInput{}%
  }\SkipToFmtEnd

\newcommand\ReadOnlyOnce[1]{\@ifundefined{#1}{\@namedef{#1}{}}\SkipToFmtEnd}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{stmaryrd}
\DeclareFontFamily{OT1}{cmtex}{}
\DeclareFontShape{OT1}{cmtex}{m}{n}
  {<5><6><7><8>cmtex8
   <9>cmtex9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmtex10}{}
\DeclareFontShape{OT1}{cmtex}{m}{it}
  {<-> ssub * cmtt/m/it}{}
\newcommand{\texfamily}{\fontfamily{cmtex}\selectfont}
\DeclareFontShape{OT1}{cmtt}{bx}{n}
  {<5><6><7><8>cmtt8
   <9>cmbtt9
   <10><10.95><12><14.4><17.28><20.74><24.88>cmbtt10}{}
\DeclareFontShape{OT1}{cmtex}{bx}{n}
  {<-> ssub * cmtt/bx/n}{}
\newcommand{\tex}[1]{\text{\texfamily#1}}	% NEU

\newcommand{\Sp}{\hskip.33334em\relax}


\newcommand{\Conid}[1]{\mathit{#1}}
\newcommand{\Varid}[1]{\mathit{#1}}
\newcommand{\anonymous}{\kern0.06em \vbox{\hrule\@width.5em}}
\newcommand{\plus}{\mathbin{+\!\!\!+}}
\newcommand{\bind}{\mathbin{>\!\!\!>\mkern-6.7mu=}}
\newcommand{\rbind}{\mathbin{=\mkern-6.7mu<\!\!\!<}}% suggested by Neil Mitchell
\newcommand{\sequ}{\mathbin{>\!\!\!>}}
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}
\usepackage{polytable}

%mathindent has to be defined
\@ifundefined{mathindent}%
  {\newdimen\mathindent\mathindent\leftmargini}%
  {}%

\def\resethooks{%
  \global\let\SaveRestoreHook\empty
  \global\let\ColumnHook\empty}
\newcommand*{\savecolumns}[1][default]%
  {\g@addto@macro\SaveRestoreHook{\savecolumns[#1]}}
\newcommand*{\restorecolumns}[1][default]%
  {\g@addto@macro\SaveRestoreHook{\restorecolumns[#1]}}
\newcommand*{\aligncolumn}[2]%
  {\g@addto@macro\ColumnHook{\column{#1}{#2}}}

\resethooks

\newcommand{\onelinecommentchars}{\quad-{}- }
\newcommand{\commentbeginchars}{\enskip\{-}
\newcommand{\commentendchars}{-\}\enskip}

\newcommand{\visiblecomments}{%
  \let\onelinecomment=\onelinecommentchars
  \let\commentbegin=\commentbeginchars
  \let\commentend=\commentendchars}

\newcommand{\invisiblecomments}{%
  \let\onelinecomment=\empty
  \let\commentbegin=\empty
  \let\commentend=\empty}

\visiblecomments

\newlength{\blanklineskip}
\setlength{\blanklineskip}{0.66084ex}

\newcommand{\hsindent}[1]{\quad}% default is fixed indentation
\let\hspre\empty
\let\hspost\empty
\newcommand{\NB}{\textbf{NB}}
\newcommand{\Todo}[1]{$\langle$\textbf{To do:}~#1$\rangle$}

\EndFmtInput
\makeatother
%
%
%
%
%
%
% This package provides two environments suitable to take the place
% of hscode, called "plainhscode" and "arrayhscode". 
%
% The plain environment surrounds each code block by vertical space,
% and it uses \abovedisplayskip and \belowdisplayskip to get spacing
% similar to formulas. Note that if these dimensions are changed,
% the spacing around displayed math formulas changes as well.
% All code is indented using \leftskip.
%
% Changed 19.08.2004 to reflect changes in colorcode. Should work with
% CodeGroup.sty.
%
\ReadOnlyOnce{polycode.fmt}%
\makeatletter

\newcommand{\hsnewpar}[1]%
  {{\parskip=0pt\parindent=0pt\par\vskip #1\noindent}}

% can be used, for instance, to redefine the code size, by setting the
% command to \small or something alike
\newcommand{\hscodestyle}{}

% The command \sethscode can be used to switch the code formatting
% behaviour by mapping the hscode environment in the subst directive
% to a new LaTeX environment.

\newcommand{\sethscode}[1]%
  {\expandafter\let\expandafter\hscode\csname #1\endcsname
   \expandafter\let\expandafter\endhscode\csname end#1\endcsname}

% "compatibility" mode restores the non-polycode.fmt layout.

\newenvironment{compathscode}%
  {\par\noindent
   \advance\leftskip\mathindent
   \hscodestyle
   \let\\=\@normalcr
   \let\hspre\(\let\hspost\)%
   \pboxed}%
  {\endpboxed\)%
   \par\noindent
   \ignorespacesafterend}

\newcommand{\compaths}{\sethscode{compathscode}}

% "plain" mode is the proposed default.
% It should now work with \centering.
% This required some changes. The old version
% is still available for reference as oldplainhscode.

\newenvironment{plainhscode}%
  {\hsnewpar\abovedisplayskip
   \advance\leftskip\mathindent
   \hscodestyle
   \let\hspre\(\let\hspost\)%
   \pboxed}%
  {\endpboxed%
   \hsnewpar\belowdisplayskip
   \ignorespacesafterend}

\newenvironment{oldplainhscode}%
  {\hsnewpar\abovedisplayskip
   \advance\leftskip\mathindent
   \hscodestyle
   \let\\=\@normalcr
   \(\pboxed}%
  {\endpboxed\)%
   \hsnewpar\belowdisplayskip
   \ignorespacesafterend}

% Here, we make plainhscode the default environment.

\newcommand{\plainhs}{\sethscode{plainhscode}}
\newcommand{\oldplainhs}{\sethscode{oldplainhscode}}
\plainhs

% The arrayhscode is like plain, but makes use of polytable's
% parray environment which disallows page breaks in code blocks.

\newenvironment{arrayhscode}%
  {\hsnewpar\abovedisplayskip
   \advance\leftskip\mathindent
   \hscodestyle
   \let\\=\@normalcr
   \(\parray}%
  {\endparray\)%
   \hsnewpar\belowdisplayskip
   \ignorespacesafterend}

\newcommand{\arrayhs}{\sethscode{arrayhscode}}

% The mathhscode environment also makes use of polytable's parray 
% environment. It is supposed to be used only inside math mode 
% (I used it to typeset the type rules in my thesis).

\newenvironment{mathhscode}%
  {\parray}{\endparray}

\newcommand{\mathhs}{\sethscode{mathhscode}}

% texths is similar to mathhs, but works in text mode.

\newenvironment{texthscode}%
  {\(\parray}{\endparray\)}

\newcommand{\texths}{\sethscode{texthscode}}

% The framed environment places code in a framed box.

\def\codeframewidth{\arrayrulewidth}
\RequirePackage{calc}

\newenvironment{framedhscode}%
  {\parskip=\abovedisplayskip\par\noindent
   \hscodestyle
   \arrayrulewidth=\codeframewidth
   \tabular{@{}|p{\linewidth-2\arraycolsep-2\arrayrulewidth-2pt}|@{}}%
   \hline\framedhslinecorrect\\{-1.5ex}%
   \let\endoflinesave=\\
   \let\\=\@normalcr
   \(\pboxed}%
  {\endpboxed\)%
   \framedhslinecorrect\endoflinesave{.5ex}\hline
   \endtabular
   \parskip=\belowdisplayskip\par\noindent
   \ignorespacesafterend}

\newcommand{\framedhslinecorrect}[2]%
  {#1[#2]}

\newcommand{\framedhs}{\sethscode{framedhscode}}

% The inlinehscode environment is an experimental environment
% that can be used to typeset displayed code inline.

\newenvironment{inlinehscode}%
  {\(\def\column##1##2{}%
   \let\>\undefined\let\<\undefined\let\\\undefined
   \newcommand\>[1][]{}\newcommand\<[1][]{}\newcommand\\[1][]{}%
   \def\fromto##1##2##3{##3}%
   \def\nextline{}}{\) }%

\newcommand{\inlinehs}{\sethscode{inlinehscode}}

% The joincode environment is a separate environment that
% can be used to surround and thereby connect multiple code
% blocks.

\newenvironment{joincode}%
  {\let\orighscode=\hscode
   \let\origendhscode=\endhscode
   \def\endhscode{\def\hscode{\endgroup\def\@currenvir{hscode}\\}\begingroup}
   %\let\SaveRestoreHook=\empty
   %\let\ColumnHook=\empty
   %\let\resethooks=\empty
   \orighscode\def\hscode{\endgroup\def\@currenvir{hscode}}}%
  {\origendhscode
   \global\let\hscode=\orighscode
   \global\let\endhscode=\origendhscode}%

\makeatother
\EndFmtInput
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Agda Styling
%%
%% TODO: Figure out spacing!

% Bitcoin symbol
\def\bitcoin{%
  \leavevmode
  \vtop{\offinterlineskip %\bfseries
    \setbox0=\hbox{B}%
    \setbox2=\hbox to\wd0{\hfil\hskip-.03em
    \vrule height .3ex width .15ex\hskip .08em
    \vrule height .3ex width .15ex\hfil}
    \vbox{\copy2\box0}\box2}}

% Horizontal lines for inference rules
\newcommand\inferSmall{\rule[3pt]{2cm}{.6pt}}
\newcommand\inferMedium{\rule[3pt]{5cm}{.6pt}}
\newcommand\inferLarge{\rule[3pt]{8cm}{.6pt}}
\newcommand\inferVeryLarge{\rule[3pt]{11cm}{.6pt}}

%% Colors (from duo-tone light syntax)
\definecolor{hsblack}{RGB}{45,32,3}
\definecolor{hsgold1}{RGB}{179,169,149}
\definecolor{hsgold2}{RGB}{177,149,90}
\definecolor{hsgold3}{RGB}{190,106,13}%{192,96,4}%{132,97,19}
\definecolor{hsblue1}{RGB}{173,176,182}
\definecolor{hsblue2}{RGB}{113,142,205}
\definecolor{hsblue3}{RGB}{0,33,132}
\definecolor{hsblue4}{RGB}{97,108,132}
\definecolor{hsblue5}{RGB}{34,50,68}
\definecolor{hsred2}{RGB}{191,121,103}
\definecolor{hsred3}{RGB}{171,72,46}

%% LaTeX Kerning nastiness. By using curly braces to delimit color group,
%% it breaks spacing. The following seems to work:
%%
%% https://tex.stackexchange.com/questions/85033/colored-symbols/85035#85035
%%
\newcommand*{\mathcolor}{}
\def\mathcolor#1#{\mathcoloraux{#1}}
\newcommand*{\mathcoloraux}[3]{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}

\newenvironment{myagda}
{ \par
  %\vspace{0.15cm}
  \begin{minipage}{\textwidth}
}
{ \end{minipage}
  %\vspace{0.15cm}
}

\newcommand{\HSKeyword}[1]{\mathcolor{hsgold3}{\textbf{#1}}}
\newcommand{\HSNumeral}[1]{\mathcolor{hsred3}{#1}}
\newcommand{\HSChar}[1]{\mathcolor{hsred2}{#1}}
\newcommand{\HSString}[1]{\mathcolor{hsred2}{#1}}
\newcommand{\HSSpecial}[1]{\mathcolor{hsblue4}{\ensuremath{#1}}}
\newcommand{\HSSym}[1]{\mathcolor{hsblue4}{\ensuremath{#1}}}
\newcommand{\HSCon}[1]{\mathcolor{hsblue3}{#1}}
\newcommand{\HSVar}[1]{\mathcolor{hsblue5}{\mathit{\ensuremath{#1}}}}
\newcommand{\HSComment}[1]{\mathcolor{hsgold2}{\textit{#1}}}



%%format :          = "\HSCon{\mathbin{:}}"

%%format .          = "\HSSym{\mathbin{\circ}}"

%%% Datatype Promotion

%%% Agda things
%%format as         = "\HSKeyword{as}"


%%% Formatting

%%% Usefull Notation
%%format λ       = "\HSSym{\lambda\ }"


\def\commentbegin{}
\def\commentend{}

\begin{document}
\sloppy % for proper justification (no overflows to the right)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Title
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Formalization of the BitML Calculus in Agda}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Authors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\author{Orestis Melkonian}
\orcid{0000-0003-2182-2698}
\affiliation{
  \department{Information and Computing Sciences}
  \institution{Utrecht University}
  \city{Utrecht}
  \country{The Netherlands}
}
%\email{melkon.or@@gmail.com}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Abstract
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
  \begin{description}
    \item[Email:] melkon.or@gmail.com
    \item[Research Advisors:] Wouter Swierstra (UU) \& Manuel Chakravarty (IOHK)
    \item[ACM Student Number:] 4094241
    \item[Category:] Graduate (MSc Student)
  \end{description}
\end{abstract}

\maketitle

\section{Introduction}
... Bitcoin $\rightarrow$ smart contracts $\rightarrow$ bus $\rightarrow$ formal methods~\cite{opportunities} ...\\
... already some static analysis tools~cite{mooly,madmax,liquidity} ...\\
... advocate language-based, type-driven approach~\cite{langverif} ...\\
... especially proof assistants based on dependent types~\cite{agda} ... extrinsic vs intrinsic ...\\

... BitML: idealistic process calculus for Bitcoin smart contracts~\cite{bitml} ...\\
... provide the first formalization of the BitML calculus in Agda ...\\
... set the foundation to later accommodate a full compilation correctness proof ... full abstraction result ...\\

\section{The BitML Calculus} 
All code is publicly available on Github\site{https://github.com/omelkonian/formal-bitml}.

\subsection{Inherently-typed Contracts}
Moving on to actual contracts, we define them by means of a collection of five types of commands;
\ensuremath{\HSVar{put}} injects participant deposits and revealed secrets in the remaining contract,
\ensuremath{\HSVar{withdraw}} transfers the current funds to a participant,
\ensuremath{\HSVar{split}} distributes the current funds across different individual contracts,
\ensuremath{\HSSym{\_}\mathbin{:}\HSSym{\_}} requires the authorization from a participant to proceed
and \ensuremath{\HSVar{after}\;\HSSym{\_}\mathbin{:}\HSSym{\_}} allows further execution of the contract only after some time has passed.
\begin{myagda}\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{9}{@{}>{\hspre}c<{\hspost}@{}}%
\column{9E}{@{}l@{}}%
\column{12}{@{}>{\hspre}l<{\hspost}@{}}%
\column{16}{@{}>{\hspre}c<{\hspost}@{}}%
\column{16E}{@{}l@{}}%
\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
\column{27}{@{}>{\hspre}l<{\hspost}@{}}%
\column{55}{@{}>{\hspre}l<{\hspost}@{}}%
\column{86}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\HSKeyword{data}\;\HSCon{Contract}{}\<[16]%
\>[16]{}\mathbin{:}{}\<[16E]%
\>[19]{}\HSCon{Value}{}\<[27]%
\>[27]{}\HSComment{ -\! - the monetary value it carries}{}\<[E]%
\\
\>[16]{}\HSSym{\to} {}\<[16E]%
\>[19]{}\HSCon{Values}{}\<[27]%
\>[27]{}\HSComment{ -\! - the deposits it presumes}{}\<[E]%
\\
\>[16]{}\HSSym{\to} {}\<[16E]%
\>[19]{}\HSCon{Set}\;\HSKeyword{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSVar{put}\;\HSSym{\_}\;\HSVar{reveal}\;\HSSym{\_}\;if\;\HSSym{\_}\HSSym{\mathrel{\Rightarrow}}\HSSym{\_}\HSSym{\vdash}\HSSym{\_}\mathbin{:}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSpecial{(}\HSVar{vs}\mathbin{:}\HSCon{List}\;\HSCon{Value}\HSSpecial{)}\HSSym{\to} \HSSpecial{(}\HSVar{s}\mathbin{:}\HSCon{Secrets}\HSSpecial{)}\HSSym{\to} \HSCon{Predicate}\;\HSVar{s}\HSSym{′\ }{}\<[55]%
\>[55]{}\HSSym{\to} \HSCon{Contract}\;\HSSpecial{(}\HSVar{v}\HSSym{+}\HSVar{sum}\;\HSVar{vs}\HSSpecial{)}\;\HSVar{vs}\HSSym{′\ }\HSSym{\to} {}\<[86]%
\>[86]{}\HSVar{s}\HSSym{′\ }\HSSym{\mathrel{\subseteq}}\HSVar{s}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} \HSCon{Contract}\;\HSVar{v}\;\HSSpecial{(}\HSVar{vs}\HSSym{′\ }\HSSym{\mathbin{\plus}}\HSVar{vs}\HSSpecial{)}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSVar{withdraw}\mathbin{:}\HSSym{∀}\HSSpecial{\HSSym{\{\mskip1.5mu} }\HSVar{v}\HSSpecial{\HSSym{\mskip1.5mu\}}}\HSSym{\to} \HSCon{Participant}\HSSym{\to} \HSCon{Contract}\;\HSVar{v}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSVar{split}\mathbin{:}{}\<[12]%
\>[12]{}\HSSpecial{(}\HSVar{cs}\mathbin{:}\HSCon{List}\;\HSSpecial{(}\HSSym{∃}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{v}\HSSpecial{\HSSym{\mskip1.5mu]}}\;\HSSym{∃}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{vs}\HSSpecial{\HSSym{\mskip1.5mu]}}\;\HSCon{Contract}\;\HSVar{v}\;\HSVar{vs}\HSSpecial{)}\HSSpecial{)}{}\<[E]%
\\
\>[3]{}\hsindent{6}{}\<[9]%
\>[9]{}\HSSym{\to} {}\<[9E]%
\>[12]{}\HSCon{Contract}\;\HSSpecial{(}\HSVar{sum}\;\HSSpecial{(}\HSVar{proj₁}\HSSym{<\!\!\$\!\!>}\HSVar{cs}\HSSpecial{)}\HSSpecial{)}\;\HSSpecial{(}\HSVar{concat}\;\HSSpecial{(}\HSVar{proj₂}\HSSym{<\!\!\$\!\!>}\HSVar{cs}\HSSpecial{)}\HSSpecial{)}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\_}\mathbin{:}\HSSym{\_}\mathbin{:}\HSCon{Participant}\HSSym{\to} \HSCon{Contract}\;\HSVar{v}\;\HSVar{vs}\HSSym{\to} \HSCon{Contract}\;\HSVar{v}\;\HSVar{vs}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSVar{after}\;\HSSym{\_}\mathbin{:}\HSSym{\_}\mathbin{:}\HSCon{Time}\HSSym{\to} \HSCon{Contract}\;\HSVar{v}\;\HSVar{vs}\HSSym{\to} \HSCon{Contract}\;\HSVar{v}\;\HSVar{vs}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\end{myagda}
There is a lot of type-level manipulation across all constructors, since we need to make sure that indices are
calculated properly. For instance, the total value in a contract constructed by the \ensuremath{\HSVar{split}} command is the 
sum of the values carried by each branch.
The \ensuremath{\HSVar{put}} command\footnote{
\ensuremath{\HSVar{put}} comprises of several components and we will omit those that do not contain any helpful information,
e.g. write \ensuremath{\HSVar{put}\;\HSSym{\_}\HSSym{\mathrel{\Rightarrow}}\HSSym{\_}} when there are no revealed secrets and the predicate trivially holds.
} additionally requires an explicit proof that the predicate
of the \ensuremath{if} part only uses secrets revealed by the same command.

\begin{myagda}\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{10}{@{}>{\hspre}l<{\hspost}@{}}%
\column{17}{@{}>{\hspre}c<{\hspost}@{}}%
\column{17E}{@{}l@{}}%
\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\HSKeyword{record}\;\HSCon{Advertisement}\;\HSSpecial{(}\HSVar{v}\mathbin{:}\HSCon{Value}\HSSpecial{)}\;\HSSpecial{(}\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny c}}}\;\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny g}}}\mathbin{:}\HSCon{List}\;\HSCon{Value}\HSSpecial{)}\mathbin{:}\HSCon{Set}\;\HSKeyword{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSKeyword{constructor}\;\HSSym{\_}\HSSym{\langle\ }\HSSym{\_}\HSSym{\ \rangle\vdash}\HSSym{\_}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSKeyword{field}\;{}\<[10]%
\>[10]{}\HSCon{G}{}\<[17]%
\>[17]{}\mathbin{:}{}\<[17E]%
\>[20]{}\HSCon{Precondition}\;\HSVar{vs}{}\<[E]%
\\
\>[10]{}\HSCon{C}{}\<[17]%
\>[17]{}\mathbin{:}{}\<[17E]%
\>[20]{}\HSCon{Contracts}\;\HSVar{v}\;\HSVar{vs}{}\<[E]%
\\
\>[10]{}\HSVar{valid}{}\<[17]%
\>[17]{}\mathbin{:}{}\<[17E]%
\>[20]{}\HSVar{length}\;\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny c}}}\HSSym{\mathrel{\leq}}\HSVar{length}\;\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny g}}}{}\<[E]%
\\
\>[17]{}\HSSym{\ \mathbin{\times}\ }{}\<[17E]%
\>[20]{}\HSVar{participants}\;\HSSym{\!\text{\textsuperscript{\tiny g}}}\;\HSCon{G}\HSSym{\mathbin{\plus}}\HSVar{participants}\;\HSSym{\!\text{\textsuperscript{\tiny c}}}\;\HSCon{C}\HSSym{\mathrel{\subseteq}}\HSSpecial{(}\HSVar{participant}\HSSym{<\!\!\$\!\!>}\HSVar{persistentDeposits}\;\HSSym{\!\text{\textsuperscript{\tiny p}}}\;\HSCon{G}\HSSpecial{)}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\end{myagda} %$

\subsection{Small-step Semantics}
... indexed configuration (+ actions) ...
\begin{myagda}\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{12}{@{}>{\hspre}c<{\hspost}@{}}%
\column{12E}{@{}l@{}}%
\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
\column{18}{@{}>{\hspre}c<{\hspost}@{}}%
\column{18E}{@{}l@{}}%
\column{21}{@{}>{\hspre}l<{\hspost}@{}}%
\column{22}{@{}>{\hspre}c<{\hspost}@{}}%
\column{22E}{@{}l@{}}%
\column{25}{@{}>{\hspre}l<{\hspost}@{}}%
\column{26}{@{}>{\hspre}c<{\hspost}@{}}%
\column{26E}{@{}l@{}}%
\column{28}{@{}>{\hspre}c<{\hspost}@{}}%
\column{28E}{@{}l@{}}%
\column{29}{@{}>{\hspre}l<{\hspost}@{}}%
\column{30}{@{}>{\hspre}c<{\hspost}@{}}%
\column{30E}{@{}l@{}}%
\column{31}{@{}>{\hspre}l<{\hspost}@{}}%
\column{33}{@{}>{\hspre}l<{\hspost}@{}}%
\column{37}{@{}>{\hspre}l<{\hspost}@{}}%
\column{44}{@{}>{\hspre}l<{\hspost}@{}}%
\column{46}{@{}>{\hspre}l<{\hspost}@{}}%
\column{48}{@{}>{\hspre}l<{\hspost}@{}}%
\column{58}{@{}>{\hspre}l<{\hspost}@{}}%
\column{66}{@{}>{\hspre}l<{\hspost}@{}}%
\column{79}{@{}>{\hspre}l<{\hspost}@{}}%
\column{92}{@{}>{\hspre}l<{\hspost}@{}}%
\column{107}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\HSKeyword{data}\;\HSCon{Configuration}\HSSym{′\ }{}\<[22]%
\>[22]{}\mathbin{:}{}\<[22E]%
\>[25]{}\HSComment{ -\! - $\hspace{22pt}$ current $\hspace{20pt}$ $\times$ $\hspace{15pt}$ required}{}\<[E]%
\\
\>[25]{}\HSCon{AdvertisedContracts}{}\<[46]%
\>[46]{}\HSSym{\ \mathbin{\times}\ }\HSCon{AdvertisedContracts}{}\<[E]%
\\
\>[22]{}\HSSym{\to} {}\<[22E]%
\>[25]{}\HSCon{ActiveContracts}{}\<[46]%
\>[46]{}\HSSym{\ \mathbin{\times}\ }\HSCon{ActiveContracts}{}\<[E]%
\\
\>[22]{}\HSSym{\to} {}\<[22E]%
\>[25]{}\HSCon{List}\;\HSCon{Deposit}{}\<[46]%
\>[46]{}\HSSym{\ \mathbin{\times}\ }\HSCon{List}\;\HSCon{Deposit}{}\<[E]%
\\
\>[22]{}\HSSym{\to} {}\<[22E]%
\>[25]{}\HSCon{Set}\;\HSKeyword{where}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - empty}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\varnothing}\mathbin{:}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - contract advertisement}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSpecial{`}\HSSym{\_}{}\<[12]%
\>[12]{}\mathbin{:}{}\<[12E]%
\>[15]{}\HSSpecial{(}\HSVar{ad}\mathbin{:}\HSCon{Advertisement}\;\HSVar{v}\;\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny c}}}\;\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny g}}}\HSSpecial{)}{}\<[E]%
\\
\>[12]{}\HSSym{\to} {}\<[12E]%
\>[15]{}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{v}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny c}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{vs}\;\HSSym{\!\text{\textsuperscript{\tiny g}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{ad}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - active contract}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\langle\ }\HSSym{\_}\HSSpecial{\HSSym{\mathbin{,}}}\HSSym{\_}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny c}}}{}\<[28]%
\>[28]{}\mathbin{:}{}\<[28E]%
\>[31]{}\HSSpecial{(}\HSVar{c}\mathbin{:}\HSCon{List}\;\HSSpecial{(}\HSCon{Contract}\;\HSVar{v}\;\HSVar{vs}\HSSpecial{)}\HSSpecial{)}\HSSym{\to} \HSCon{Value}{}\<[E]%
\\
\>[28]{}\HSSym{\to} {}\<[28E]%
\>[31]{}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{v}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{vs}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{c}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - deposit redeemable by a participant}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\langle\ }\HSSym{\!\_}\HSSpecial{\HSSym{\mathbin{,}}}\HSSym{\_}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}{}\<[28]%
\>[28]{}\mathbin{:}{}\<[28E]%
\>[31]{}\HSSpecial{(}\HSVar{p}\mathbin{:}\HSCon{Participant}\HSSpecial{)}\HSSym{\to} \HSSpecial{(}\HSVar{v}\mathbin{:}\HSCon{Value}\HSSpecial{)}{}\<[E]%
\\
\>[28]{}\HSSym{\to} {}\<[28E]%
\>[31]{}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{p}\;\HSVar{has}\;\HSVar{v}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - authorization to perform an action}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\_\!}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSym{\_}\HSSpecial{\HSSym{\mskip1.5mu]}}{}\<[21]%
\>[21]{}\mathbin{:}\HSSpecial{(}\HSVar{p}\mathbin{:}\HSCon{Participant}\HSSpecial{)}\HSSym{\to} \HSCon{Action}\;\HSVar{p}\;\HSVar{ads}\;\HSVar{cs}\;\HSVar{vs}\;\HSVar{ds}{}\<[E]%
\\
\>[21]{}\HSSym{\to} \HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{ads}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{cs}\HSSpecial{)}\;\HSSpecial{(}\HSVar{ds}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{(}\HSSpecial{(}\HSVar{p}\;\HSVar{has}\;\HSSym{\_}\HSSpecial{)}\HSSym{<\!\!\$\!\!>}\HSVar{vs}\HSSpecial{)}\HSSpecial{)}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - committed secret}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\langle\ }\HSSym{\_}\HSSym{∶}\HSSym{\_}\HSSym{\ ♯}\HSSym{\_}\HSSym{\ \rangle}{}\<[30]%
\>[30]{}\mathbin{:}{}\<[30E]%
\>[33]{}\HSCon{Participant}\HSSym{\to} {}\<[48]%
\>[48]{}\HSCon{Secret}\HSSym{\to} {}\<[58]%
\>[58]{}\HSSym{\mathbb{N}}\HSSym{\mathbin{\uplus}}\HSSym{\bot}{}\<[E]%
\\
\>[30]{}\HSSym{\to} {}\<[30E]%
\>[33]{}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - revealed secret}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\_}\HSSym{∶}\HSSym{\_}\HSSym{\ ♯}\HSSym{\_}{}\<[26]%
\>[26]{}\mathbin{:}{}\<[26E]%
\>[29]{}\HSCon{Participant}\HSSym{\to} {}\<[44]%
\>[44]{}\HSCon{Secret}\HSSym{\to} \HSSym{\mathbb{N}}{}\<[E]%
\\
\>[26]{}\HSSym{\to} {}\<[26E]%
\>[29]{}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSComment{ -\! - parallel composition}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\_}\HSSym{\mid} \HSSym{\_}{}\<[18]%
\>[18]{}\mathbin{:}{}\<[18E]%
\>[21]{}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSVar{ads}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rads}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{)}\;\HSSpecial{(}\HSVar{cs}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rcs}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{)}\;\HSSpecial{(}\HSVar{ds}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rds}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{)}{}\<[E]%
\\
\>[18]{}\HSSym{\to} {}\<[18E]%
\>[21]{}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSVar{ads}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rads}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}\HSSpecial{)}\;\HSSpecial{(}\HSVar{cs}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rcs}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}\HSSpecial{)}\;\HSSpecial{(}\HSVar{ds}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rds}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}\HSSpecial{)}{}\<[E]%
\\
\>[18]{}\HSSym{\to} {}\<[18E]%
\>[21]{}\HSCon{Configuration}\HSSym{′\ }{}\<[37]%
\>[37]{}\HSSpecial{(}\HSVar{ads}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}{}\<[66]%
\>[66]{}\HSSym{\mathbin{\plus}}\HSVar{ads}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}{}\<[79]%
\>[79]{}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rads}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}{}\<[92]%
\>[92]{}\HSSym{\mathbin{\plus}}\HSSpecial{(}\HSVar{rads}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}{}\<[107]%
\>[107]{}\HSSym{\setminus}\HSVar{ads}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{)}\HSSpecial{)}{}\<[E]%
\\
\>[37]{}\HSSpecial{(}\HSVar{cs}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}{}\<[66]%
\>[66]{}\HSSym{\mathbin{\plus}}\HSVar{cs}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}{}\<[79]%
\>[79]{}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rcs}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}{}\<[92]%
\>[92]{}\HSSym{\mathbin{\plus}}\HSSpecial{(}\HSVar{rcs}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}{}\<[107]%
\>[107]{}\HSSym{\setminus}\HSVar{cs}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{)}\HSSpecial{)}{}\<[E]%
\\
\>[37]{}\HSSpecial{(}\HSSpecial{(}\HSVar{ds}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSym{\setminus}\HSVar{rds}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}\HSSpecial{)}{}\<[66]%
\>[66]{}\HSSym{\mathbin{\plus}}\HSVar{ds}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}{}\<[79]%
\>[79]{}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{rds}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}{}\<[92]%
\>[92]{}\HSSym{\mathbin{\plus}}\HSSpecial{(}\HSVar{rds}\;\HSSym{\!\text{\textsuperscript{\tiny r}}}{}\<[107]%
\>[107]{}\HSSym{\setminus}\HSVar{ds}\;\HSSym{\!\text{\textsuperscript{\tiny l}}}\HSSpecial{)}\HSSpecial{)}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\HSCon{Configuration}\mathbin{:}\HSCon{AdvertisedContracts}\HSSym{\to} \HSCon{ActiveContracts}\HSSym{\to} \HSCon{List}\;\HSCon{Deposit}\HSSym{\to} \HSCon{Set}{}\<[E]%
\\
\>[B]{}\HSCon{Configuration}\;\HSVar{ads}\;\HSVar{cs}\;\HSVar{ds}\HSSym{\mathrel{=}}\HSCon{Configuration}\HSSym{′\ }\HSSpecial{(}\HSVar{ads}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSVar{cs}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}\;\HSSpecial{(}\HSVar{ds}\HSSpecial{\HSSym{\mathbin{,}}}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\end{myagda} %$

... inference rules ...
\begin{myagda}\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\HSKeyword{data}\;\HSSym{\_}\HSSym{\mathrel{\longrightarrow}}\HSSym{\_}\mathbin{:}\HSCon{Configuration}\;\HSVar{ads}\;\HSVar{cs}\;\HSVar{ds}\HSSym{\to} \HSCon{Configuration}\;\HSVar{ads}\HSSym{′\ }\HSVar{cs}\HSSym{′\ }\HSVar{ds}\HSSym{′\ }\HSSym{\to} \HSCon{Set}\;\HSKeyword{where}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSCon{DEP}\HSSym{\text{\textit{-}}}\HSCon{AuthJoin}\mathbin{:}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{′\ }\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSSym{\Gamma}\HSSym{\mathrel{\longrightarrow}}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{′\ }\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSCon{A}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSNumeral{0}\HSSym{↔}\HSNumeral{1}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSym{\mid} \HSSym{\Gamma}{}\<[E]%
\\
\>[B]{}\vspace{10pt}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSCon{DEP}\HSSym{\text{\textit{-}}}\HSCon{Join}\mathbin{:}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{′\ }\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSCon{A}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSNumeral{0}\HSSym{↔}\HSNumeral{1}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSym{\mid} \HSSym{\Gamma}\HSSym{\mathrel{\longrightarrow}}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{+}\HSVar{v}\HSSym{′\ }\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSSym{\Gamma}{}\<[E]%
\\
\>[B]{}\vspace{10pt}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Advertise}\mathbin{:}\HSSym{∀}\HSSpecial{\HSSym{\{\mskip1.5mu} }\HSSym{\Gamma}\;\HSVar{ad}\HSSpecial{\HSSym{\mskip1.5mu\}}}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[8]%
\>[8]{}\HSSym{∃}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{p}\HSSym{\mathrel{\in}}\HSVar{participants}\;\HSSym{\!\text{\textsuperscript{\tiny g}}}\;\HSSpecial{(}\HSCon{G}\;\HSVar{ad}\HSSpecial{)}\HSSpecial{\HSSym{\mskip1.5mu]}}\;\HSVar{p}\HSSym{\mathrel{\in}}\HSCon{Hon}{}\<[E]%
\\
\>[8]{}\mbox{\commentbegin  $\inferLarge$  \commentend}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[8]%
\>[8]{}\HSSym{\Gamma}\HSSym{\mathrel{\longrightarrow}}\HSSpecial{`}\HSVar{ad}\HSSym{\mid} \HSSym{\Gamma}{}\<[E]%
\\
\>[B]{}\vspace{10pt}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{AuthCommit}\mathbin{:}\HSSym{∀}\HSSpecial{\HSSym{\{\mskip1.5mu} }\HSCon{A}\;\HSVar{ad}\;\HSSym{\Gamma}\HSSpecial{\HSSym{\mskip1.5mu\}}}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[8]%
\>[8]{}\HSVar{secrets}\;\HSSpecial{(}\HSCon{G}\;\HSVar{ad}\HSSpecial{)}\HSSym{\mathrel{\equiv}}\HSVar{a₀}\;\HSSym{\dots}\;\HSVar{aₙ}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[8]%
\>[8]{}\HSSpecial{(}\HSCon{A}\HSSym{\mathrel{\in}}\HSCon{Hon}\HSSym{\to} \HSSym{∀}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{i}\HSSym{\mathrel{\in}}\HSNumeral{0}\;\HSSym{\dots}\;\HSVar{n}\HSSpecial{\HSSym{\mskip1.5mu]}}\;\HSVar{a}\;\HSSym{\!\text{\textsubscript{\tiny i}}}\HSSym{≢}\HSSym{\bot}\HSSpecial{)}{}\<[E]%
\\
\>[8]{}\mbox{\commentbegin  $\inferLarge$  \commentend}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[8]%
\>[8]{}\HSSpecial{`}\HSVar{ad}\HSSym{\mid} \HSSym{\Gamma}\HSSym{\mathrel{\longrightarrow}}\HSSpecial{`}\HSVar{ad}\HSSym{\mid} \HSSym{\Gamma}\HSSym{\mid} \HSSym{\dots}\HSSym{\langle\ }\HSCon{A}\mathbin{:}\HSVar{a}\;\HSSym{\!\text{\textsubscript{\tiny i}}}\HSSym{\ ♯}\HSCon{N}\;\HSSym{\!\text{\textsubscript{\tiny i}}}\HSSym{\ \rangle}\HSSym{\dots}\;\HSSym{\! | \!}\;\HSCon{A}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSym{♯▷}\;\HSVar{ad}\HSSpecial{\HSSym{\mskip1.5mu]}}{}\<[E]%
\\
\>[B]{}\vspace{10pt}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Control}\mathbin{:}\HSSym{∀}\HSSpecial{\HSSym{\{\mskip1.5mu} }\HSSym{\Gamma}\;\HSCon{C}\;\HSVar{i}\;\HSCon{D}\HSSpecial{\HSSym{\mskip1.5mu\}}}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[8]%
\>[8]{}\HSCon{C}\HSSym{\mathbin{!!}}\HSVar{i}\HSSym{\mathrel{\equiv}}\HSCon{A₁}\mathbin{:}\HSCon{A₂}\mathbin{:}\HSSym{\dots}\mathbin{:}\HSCon{Aₙ}\mathbin{:}\HSCon{D}{}\<[E]%
\\
\>[8]{}\mbox{\commentbegin  $\inferLarge$  \commentend}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[8]%
\>[8]{}\HSSym{\langle\ }\HSCon{C}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny c}}}\HSSym{\mid} \HSSym{\dots}\;\HSCon{A}\;\HSSym{\!\text{\textsubscript{\tiny i}}}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\;\HSSym{{\vartriangleright}^b}\;\HSVar{i}\HSSpecial{\HSSym{\mskip1.5mu]}}\;\HSSym{\dots}\HSSym{\mid} \HSSym{\Gamma}\HSSym{\mathrel{\longrightarrow}}\HSSym{\langle\ }\HSCon{D}\HSSpecial{\HSSym{\mathbin{,}}}\HSVar{v}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny c}}}\HSSym{\mid} \HSSym{\Gamma}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\vdots}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\end{myagda}

... mention timed-configurations at the upper level \ensuremath{\HSSym{\_}\HSSym{\mathrel{\longrightarrow}}\HSSym{\!\text{\textsubscript{\tiny t}}}\;\HSSym{\_}} ...

... implicit re-ordering in \ensuremath{\HSSym{\_}\HSSym{\mathrel{\twoheadrightarrow}}\HSSym{\_}} ...
\begin{myagda}\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}c<{\hspost}@{}}%
\column{5E}{@{}l@{}}%
\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
\column{36}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\HSKeyword{data}\;\HSSym{\_}\HSSym{\mathrel{\twoheadrightarrow}}\HSSym{\_}\mathbin{:}\HSCon{Configuration}\;\HSVar{ads}\;\HSVar{cs}\;\HSVar{ds}\HSSym{\to} \HSCon{Configuration}\;\HSVar{ads}\HSSym{′\ }\HSVar{cs}\HSSym{′\ }\HSVar{ds}\HSSym{′\ }\HSSym{\to} \HSCon{Set}\;\HSKeyword{where}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\_}\HSSym{\text{\mbox{\tiny$\square$}}}\mathbin{:}\HSSpecial{(}\HSCon{M}\mathbin{:}\HSCon{Configuration}\;\HSVar{ads}\;\HSVar{cs}\;\HSVar{ds}\HSSpecial{)}\HSSym{\to} \HSCon{M}\HSSym{\mathrel{\twoheadrightarrow}}\HSCon{M}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\_}\HSSym{\mathrel{\longrightarrow}}\HSSym{\langle\ }\HSSym{\_}\HSSym{\ \rangle}\HSSym{\_}\mathbin{:}\HSSym{∀}\HSSpecial{\HSSym{\{\mskip1.5mu} }\HSCon{M}\;{}\<[36]%
\>[36]{}\HSCon{N}\HSSpecial{\HSSym{\mskip1.5mu\}}}\;\HSSpecial{(}\HSCon{L}\mathbin{:}\HSCon{Configuration}\;\HSVar{ads}\;\HSVar{cs}\;\HSVar{ds}\HSSpecial{)}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[5E]%
\>[8]{}\HSCon{L}\HSSym{\mathrel{\longrightarrow}}\HSCon{M}\HSSym{\to} \HSCon{M}\HSSym{\mathrel{\twoheadrightarrow}}\HSCon{N}{}\<[E]%
\\
\>[8]{}\mbox{\commentbegin  $\inferMedium$  \commentend}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\to} {}\<[5E]%
\>[8]{}\HSCon{L}\HSSym{\mathrel{\twoheadrightarrow}}\HSCon{N}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\HSVar{begin}\;\HSSym{\_}\mathbin{:}\HSSym{∀}\HSSpecial{\HSSym{\{\mskip1.5mu} }\HSCon{M}\;\HSCon{N}\HSSpecial{\HSSym{\mskip1.5mu\}}}\HSSym{\to} \HSCon{M}\HSSym{\mathrel{\twoheadrightarrow}}\HSCon{N}\HSSym{\to} \HSCon{M}\HSSym{\mathrel{\twoheadrightarrow}}\HSCon{N}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\end{myagda}

\paragraph{Symbolic model}
\begin{itemize}
\item honest strategies
\item adversary strategy
\item conformance
\end{itemize}

\section{Example: Timed-commitment Protocol}
\begin{myagda}\begin{hscode}\SaveRestoreHook
\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
\>[B]{}\HSVar{tc}\mathbin{:}\HSCon{Advertisement}\;\HSNumeral{1}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\;\HSSpecial{(}\HSNumeral{1}\HSCon{::}\HSNumeral{0}\HSCon{::}\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{)}{}\<[E]%
\\
\>[B]{}\HSVar{tc}\HSSym{\mathrel{=}}{}\<[7]%
\>[7]{}\HSSym{\langle\ }\HSCon{A}\HSSym{\mathbin{!}}\HSNumeral{1}\HSSym{\mathbin{\land}}\HSCon{A}\HSSym{\ ♯}\HSVar{a}\HSSym{\mathbin{\land}}\HSCon{B}\HSSym{\mathbin{!}}\HSNumeral{0}\HSSym{\ \rangle}\;\HSVar{reveal}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{a}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSym{\mathrel{\Rightarrow}}\HSVar{withdraw}\;\HSCon{A}\HSSym{\vdash}\HSSym{\dots}\;\HSSym{\mathbin{\oplus}}\;\HSVar{after}\;\HSVar{t}\HSSym{∶}\HSVar{withdraw}\;\HSCon{B}{}\<[E]%
\\[\blanklineskip]%
\>[B]{}\HSVar{tc}\HSSym{\text{\textit{-}}}\HSVar{semantics}\mathbin{:}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mathrel{\twoheadrightarrow}}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSNumeral{6}{}\<[E]%
\\
\>[B]{}\HSVar{tc}\HSSym{\text{\textit{-}}}\HSVar{semantics}\HSSym{\mathrel{=}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSVar{begin}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Advertise}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSpecial{`}\HSVar{tc}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{AuthCommit}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSpecial{`}\HSVar{tc}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSNumeral{6}\HSSym{\ \rangle}\HSSym{\mid} \HSCon{A}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSym{♯\!\vartriangleright}\;\HSVar{tc}\HSSpecial{\HSSym{\mskip1.5mu]}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{AuthInit}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSpecial{`}\HSVar{tc}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSNumeral{6}\HSSym{\ \rangle}\HSSym{\mid} \HSCon{A}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSSym{♯\!\vartriangleright}\;\HSVar{tc}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSym{\mid} \HSCon{A}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{tc}\;\HSSym{{\vartriangleright}^s}\;\HSNumeral{0}\HSSpecial{\HSSym{\mskip1.5mu]}}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Init}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSVar{tc}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny c}}}\HSSym{\mid} \HSSym{\langle\ }\HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSVar{inj₁}\;\HSNumeral{6}\HSSym{\ \rangle}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{AuthRev}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSVar{tc}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny c}}}\HSSym{\mid} \HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSNumeral{6}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Control}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{reveal}\;\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{a}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSym{\mathrel{\Rightarrow}}\HSVar{withdraw}\;\HSCon{A}\HSSym{\vdash}\HSSym{\dots}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny c}}}\HSSym{\mid} \HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSNumeral{6}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{PutRev}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSSpecial{\HSSym{[\mskip1.5mu} }\HSVar{withdraw}\;\HSCon{A}\HSSpecial{\HSSym{\mskip1.5mu]}}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny c}}}\HSSym{\mid} \HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSNumeral{6}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\longrightarrow\!\langle\ }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Withdraw}\HSSym{\ \rangle}{}\<[E]%
\\
\>[3]{}\hsindent{2}{}\<[5]%
\>[5]{}\HSSym{\langle\ }\HSCon{A}\HSSpecial{\HSSym{\mathbin{,}}}\HSNumeral{1}\HSSym{\ \rangle}\HSSym{\text{\textsuperscript{\tiny d}}}\HSSym{\mid} \HSCon{A}\HSSym{∶}\HSVar{a}\HSSym{\ ♯}\HSNumeral{6}{}\<[E]%
\\
\>[B]{}\hsindent{3}{}\<[3]%
\>[3]{}\HSSym{\text{\mbox{\tiny$\square$}}}{}\<[E]%
\ColumnHook
\end{hscode}\resethooks
\end{myagda}
At first, \ensuremath{\HSCon{A}} holds a deposit of \bitcoin ~1, as required by the contract's precondition.
Then, the contract is advertised and the participants slowly provide the corresponding prerequisites
(i.e. \ensuremath{\HSCon{A}} commits to a secret via \ensuremath{\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{AuthCommit}\HSSpecial{\HSSym{\mskip1.5mu]}}} and spends the required deposit via \ensuremath{\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{AuthInit}\HSSpecial{\HSSym{\mskip1.5mu]}}},
while \ensuremath{\HSCon{B}} does not do anything).
After all pre-conditions have been satisfied, the contract is stipulated (rule \ensuremath{\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Init}\HSSpecial{\HSSym{\mskip1.5mu]}}}) and the secret is successfully
revealed (rule \ensuremath{\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{AuthRev}\HSSpecial{\HSSym{\mskip1.5mu]}}}).
Finally, the first branch is picked (rule \ensuremath{\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Control}\HSSpecial{\HSSym{\mskip1.5mu]}}}) and \ensuremath{\HSCon{A}} retrieves her deposit back
(rules \ensuremath{\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{PutRev}\HSSpecial{\HSSym{\mskip1.5mu]}}} and \ensuremath{\HSSpecial{\HSSym{[\mskip1.5mu} }\HSCon{C}\HSSym{\text{\textit{-}}}\HSCon{Withdraw}\HSSpecial{\HSSym{\mskip1.5mu]}}}).

\section{Future}
... instead of BitML->Bitcoin~\cite{bitml} ...\\
... BitML->FormalUTxO~\site{https://github.com/omelkonian/formal-utxo}~\cite{utxo} ...\\
... will be easier with the added expressivity from data scripts~\cite{eutxo} ... c.f. Marlowe~\cite{marlowe} ...\\

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliography{sources}

\end{document}
